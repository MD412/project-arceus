/******** Navigation & Layout Styles ********/

:root {
  --sidebar-width: var(--sds-size-width-sidebar);
  --sidebar-width-minimized: 60px;
}

.app-layout {
  --sidebar-width: var(--sds-size-width-sidebar); /* Default: expanded width */
  display: grid;
  grid-template-columns: auto 1fr; /* Figma auto-layout: sidebar hugs its content */
  height: 100vh; /* Changed from min-height to constrain grid */
  width: 100%;
  transition: grid-template-columns 0.25s cubic-bezier(0.4, 0, 0.2, 1); /* Mobile-style smooth animation */
  overflow: visible; /* Allow sidebar button to extend outside */
}

/* When sidebar is minimized */
.app-layout:has(.sidebar--minimized) {
  --sidebar-width: var(--sidebar-width-minimized); /* Update custom property for fixed elements */
  grid-template-columns: var(--sidebar-width-minimized) 1fr; /* Keep fixed width when minimized */
}

/* Floating minimize toggle - positioned relative to top-right of sidebar */
.sidebar-floating-toggle {
  position: absolute;
  right: -32px; /* Position just outside the sidebar's right edge */
  top: 8px; /* Align with top toolbar height */
  width: 32px;
  height: 32px;
  background: var(--surface-background);
  border: 1px solid var(--border-default);
  border-radius: var(--sds-size-radius-100);
  color: var(--text-secondary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  /* Removed transition for snappy shadcn-style interaction */
  z-index: 100; /* Above the main content but below overlays */
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.sidebar-floating-toggle:hover {
  background: var(--surface-subtle);
  color: var(--text-primary);
}

/* Sidebar Container - now uses CSS Grid, no fixed positioning needed */
.circuit-sidebar {
  position: relative; /* For minimize button positioning */
  display: flex;
  flex-direction: column;
  gap: 0; /* Remove gap - let children handle spacing */
  padding: 0;
  background: var(--surface-background);
  border-right: 1px solid var(--border-default);
  /* Figma auto-layout: hug contents with sensible constraints */
  min-width: 200px; /* Minimum readable width */
  max-width: 320px; /* Maximum to prevent taking over screen */
  width: max-content; /* Hug the content like Figma auto-layout */
  /* Mobile-style smooth animations for minimize/expand */
  transition: width 0.25s cubic-bezier(0.4, 0, 0.2, 1), min-width 0.25s cubic-bezier(0.4, 0, 0.2, 1), max-width 0.25s cubic-bezier(0.4, 0, 0.2, 1);
}

/* When minimized, hide text and center icon */
.circuit-sidebar.sidebar--minimized {
  width: var(--sidebar-width-minimized) !important; /* Override auto-layout when minimized */
  min-width: var(--sidebar-width-minimized) !important;
  max-width: var(--sidebar-width-minimized) !important;
}

/* Override the nav container padding when minimized */
.circuit-sidebar.sidebar--minimized .sidebar-nav {
  padding: var(--sds-size-space-200);
}

.circuit-sidebar.sidebar--minimized .sidebar-nav-header {
  padding: var(--sds-size-space-400) var(--sds-size-space-200);
}

.circuit-sidebar.sidebar--minimized .sidebar-nav-title {
  font-size: var(--font-size-125);
  text-align: center;
}

.circuit-sidebar.sidebar--minimized .sidebar-nav-link,
.circuit-sidebar.sidebar--minimized .sidebar-nav-group-heading,
.circuit-sidebar.sidebar--minimized .sidebar-nav-group-toggle {
  padding: var(--sds-size-space-200);
  justify-content: center;
}

.circuit-sidebar.sidebar--minimized .sidebar-nav-icon {
  margin: 0;
}

.circuit-sidebar.sidebar--minimized .sidebar-nav-sublist {
  display: none; /* Hide subitems when minimized */
}

/* Old minimized logout button styles removed */

/* Ensure the nav inside takes up remaining space to push logout to bottom */
.circuit-sidebar nav {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow-y: auto; /* Allow nav content to scroll */
}

/* Ensure the navigation content stretches to fill available space */
.circuit-sidebar .sidebar-nav {
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: 0; /* Remove padding from nav container to make scrollbar flush */
}

/* Apply padding to the nav header and list instead */
.circuit-sidebar .sidebar-nav-header {
  height: 48px; /* Match top-toolbar height */
  display: flex;
  align-items: center;
  padding: 0 var(--sds-size-space-300); /* 12px horizontal padding only */
  margin: 0; /* Reset margin */
  flex-shrink: 0; /* Prevent shrinking */
}

.circuit-sidebar .sidebar-nav-list {
  flex: 1;
  overflow-y: auto; /* Allow list to scroll if needed */
  overflow-x: visible; /* Allow minimize button to extend outside */
  padding: 8px 0; /* 4px top/bottom, 0 left/right for minimized */
}

/* Add left-right padding back in expanded mode only */
.circuit-sidebar:not(.sidebar--minimized) .sidebar-nav-list {
  padding: 8px; /* 4px on all sides when expanded */
}

/* Custom scrollbar styling for webkit browsers */
.circuit-sidebar .sidebar-nav-list::-webkit-scrollbar {
  width: 8px;
}

.circuit-sidebar .sidebar-nav-list::-webkit-scrollbar-track {
  background: transparent;
}

.circuit-sidebar .sidebar-nav-list::-webkit-scrollbar-thumb {
  background-color: var(--border-subtle);
  border-radius: 4px;
}

.circuit-sidebar .sidebar-nav-list::-webkit-scrollbar-thumb:hover {
  background-color: var(--border-default);
}

/* Footer navigation - sticks to bottom - uses AppNavigation.css styling */

/* Old logout button styles removed - now using proper navigation structure */

/* Main content area - no margin needed, Grid handles layout! */
.main-content-area {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  height: 100vh; /* Explicit height for percentage children */
  overflow: hidden; /* Changed from overflow-y: auto - let page contents handle their own scroll */
  /* Removed position: relative and z-index to prevent stacking context isolation */
}

.app-content {
  flex: 1;
  min-height: 0; /* Critical for flex children to respect parent height */
  padding: var(--sds-size-space-400) var(--sds-size-space-600);
  overflow: hidden; /* Prevent content from creating scrollbars */
  position: relative;
  z-index: 1; /* Below top-toolbar */
}

/* Page-specific overrides */
.app-content--no-padding {
  padding: 0;
}

.top-toolbar {
  height: 48px;
  flex-shrink: 0;
  background-color: var(--circuit-mid-teal);
  border-bottom: 1px solid var(--border-default);
  display: flex;
  align-items: center;
  justify-content: flex-end;
  position: sticky; /* Restored original positioning */
  top: 0;
  z-index: 100; /* Below modal backdrop (z-index: 9998) so it gets shadowed out */
}

/* Action toolbar integration - Figma auto-layout */
.top-toolbar .action-toolbar {
  height: 100%;
  padding: 0 !important; /* Override base action-toolbar padding */
  margin: 0;
  border-bottom: none; /* Avoid double borders */
  gap: 0;
  /* Figma auto-layout: space-between with flex */
  justify-content: space-between;
  width: 100%;
}

/* Removed unused .toolbar-status - the empty div was deleted */

/* Toolbar action buttons - specific to the main app toolbar */
.top-toolbar .toolbar-action-button {
  width: 48px;
  height: 100%;
  background-color: transparent;
  /* Reset base button border - NO bottom border needed since toolbar provides it */
  border: none;
  border-left: 1px solid var(--circuit-light-teal); /* Only left border to separate buttons */
  border-radius: 0;
  padding: 0;
  margin: 0;
  cursor: pointer;
  color: var(--text-primary);
  font-size: 24px;
  line-height: 48px;
  text-align: center;
  display: flex;
  align-items: center;
  justify-content: center;
}

.top-toolbar .toolbar-action-button:hover {
  background-color: var(--circuit-dark-teal);
  /* Maintain the same border - NO bottom border needed */
  border: none;
  border-left: 1px solid var(--circuit-light-teal); /* Only left border to separate buttons */
}

.toolbar-action-button svg {
  width: 24px;
  height: 24px;
}

/* Text variant of the toolbar button */
.top-toolbar .toolbar-action-button.with-text {
  width: auto;
  padding: 0 20px; /* Decreased from 22px to 20px (2px less on each side) */
  font-size: 14px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  /* Reset base button borders - NO bottom border needed since toolbar provides it */
  border: none;
  border-left: 1px solid var(--circuit-light-teal); /* Only left border to separate buttons */
}

/* 
  The conditional margin logic below is no longer needed because we are using
  separate layouts for the main app and other pages like auth or the design system.
  The .app-content class will only exist within the app layout where the sidebar is always present.
*/
/*
.app-content:has(> .circuitds-layout-container),
.app-content:has(> .login-container),
.app-content:has(> .signup-container) {
  margin-left: 0;
  padding: 0; 
} 
*/ 

/* Mobile Navigation Styles */
@media (max-width: 767px) {
  .app-layout {
    display: block; /* Remove grid on mobile */
    height: 100vh;
    width: 100%;
    position: relative;
    overflow: hidden; /* Prevent horizontal scroll from off-screen sidebar */
  }
  
  /* Main content takes full height without grid */
  .main-content-area {
    height: 100vh;
    width: 100%;
    position: relative;
  }
  
  /* Mobile toolbar buttons need bottom border since mobile doesn't have toolbar container border */
  .top-toolbar .toolbar-action-button {
    border-bottom: 1px solid var(--circuit-light-teal);
  }
  
  .top-toolbar .toolbar-action-button:hover {
    border-bottom: 1px solid var(--circuit-light-teal);
  }
  
  .top-toolbar .toolbar-action-button.with-text {
    border-bottom: 1px solid var(--circuit-light-teal);
  }
  
  .circuit-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: min(280px, 85vw); /* Responsive width, max 85% of viewport */
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height for mobile browsers */
    z-index: 1000;
    transform: translateX(-100%);
    transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    /* Prevent scrolling when sidebar is open */
    overscroll-behavior: contain;
  }
  
  .circuit-sidebar.sidebar--open {
    transform: translateX(0);
    box-shadow: 2px 0 24px rgba(0, 0, 0, 0.15);
  }
  
  /* Mobile navigation toggle button - styled like toolbar */
  .nav-toggle-btn {
    position: fixed;
    top: env(safe-area-inset-top, 0);
    left: 0;
    z-index: 1100;
    width: 48px;
    height: 48px;
    border: none;
    border-right: 1px solid var(--circuit-light-teal);
    border-bottom: 1px solid var(--circuit-light-teal);
    border-radius: 0;
    background: var(--circuit-mid-teal); /* Match toolbar background */
    color: var(--text-primary); /* Contrasting icon color */
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: none; /* Remove shadow to match toolbar */
    /* Improved touch target */
    -webkit-tap-highlight-color: transparent;
  }

  /* 2-bar menu icon */
  .nav-toggle-icon {
    width: 22px; /* Even number for better pixel alignment */
    height: 8px; /* Even number for better pixel alignment */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: stretch; /* Ensure bars stretch to full width */
    position: relative;
  }

  .nav-toggle-bar {
    width: 100%;
    height: 2px;
    background: var(--text-primary);
    border-radius: 0; /* Remove border-radius for crisp edges */
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: center;
    display: block;
    /* Force hardware acceleration for consistent rendering */
    will-change: transform;
    backface-visibility: hidden;
    /* Ensure crisp pixel rendering */
    transform: translateZ(0);
  }

  /* Animate to X when open */
  .nav-toggle-btn.is-open .nav-toggle-bar:first-child {
    transform: translateY(3px) rotate(45deg) translateZ(0); /* Even spacing for pixel alignment */
  }

  .nav-toggle-btn.is-open .nav-toggle-bar:last-child {
    transform: translateY(-3px) rotate(-45deg) translateZ(0); /* Even spacing for pixel alignment */
  }
  
  .nav-toggle-btn:hover {
    background: var(--circuit-dark-teal); /* Match toolbar hover */
    border-right: 1px solid var(--circuit-light-teal); /* Explicitly maintain border */
    border-bottom: 1px solid var(--circuit-light-teal); /* Explicitly maintain border */
  }
  
  .nav-toggle-btn:active {
    background: var(--circuit-dark-teal);
    border-right: 1px solid var(--circuit-light-teal); /* Explicitly maintain border */
    border-bottom: 1px solid var(--circuit-light-teal); /* Explicitly maintain border */
    transform: none; /* Remove scale for toolbar consistency */
  }
  
  /* When sidebar is open, show close button with subtle styling */
  .nav-toggle-btn.is-open {
    left: calc(min(280px, 85vw) + 0px); /* Align with sidebar edge */
    background: var(--circuit-mid-teal);
    color: var(--text-primary);
    border-right: 1px solid var(--circuit-light-teal);
    border-bottom: 1px solid var(--circuit-light-teal);
    border-left: none; /* Remove left border when open */
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1); /* Subtle shadow when floating */
  }
  
  .nav-toggle-btn.is-open:hover {
    background: var(--circuit-dark-teal);
    border-right: 1px solid var(--circuit-light-teal); /* Explicitly maintain border */
    border-bottom: 1px solid var(--circuit-light-teal); /* Explicitly maintain border */
    border-left: none; /* Explicitly maintain no left border */
  }
  
  /* Mobile overlay */
  .sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
    z-index: 900;
    opacity: 0;
    animation: fadeIn 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  
  @keyframes fadeIn {
    to { opacity: 1; }
  }
  
  /* Prevent body scroll when mobile menu is open */
  body:has(.sidebar--open) {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100vh;
    top: 0;
    left: 0;
  }
  
  /* Mobile content adjustments */
  .app-content {
    padding: calc(env(safe-area-inset-top, 0px) + 48px) var(--sds-size-space-400) var(--sds-size-space-400);
    /* Add top padding for toolbar-integrated toggle button */
    height: calc(100vh - 48px); /* Account for toolbar height */
    overflow-y: auto; /* Allow content scrolling */
  }
  
  /* Mobile sidebar uses EXACT same styles as desktop - no overrides */
  
  /* Old minimized logout button styles removed */
}

@media (min-width: 768px) {
  .nav-toggle-btn {
    display: none;
  }
  
  .sidebar-overlay {
    display: none;
  }
}

/* Hide minimize toggles on mobile */
@media (max-width: 767px) {
  .sidebar-floating-toggle {
    display: none !important; /* Ensure it's hidden even if JS tries to show it */
  }
}

/* Landscape mobile adjustments */
@media (max-width: 767px) and (orientation: landscape) {
  .circuit-sidebar {
    width: min(320px, 70vw); /* Wider sidebar in landscape */
  }
  
  .nav-toggle-btn.is-open {
    left: calc(min(320px, 70vw) + 0px); /* Align with sidebar edge */
  }
  
  /* Override minimized state in landscape too */
  .circuit-sidebar.sidebar--minimized {
    width: min(320px, 70vw) !important;
  }
}

/* Small mobile devices */
@media (max-width: 480px) {
  .circuit-sidebar {
    width: min(260px, 90vw); /* Smaller sidebar on very small screens */
  }
  
  .nav-toggle-btn.is-open {
    left: calc(min(260px, 90vw) + 0px); /* Align with sidebar edge */
  }
  
  .app-content {
    padding: calc(env(safe-area-inset-top, 0px) + 48px) var(--sds-size-space-300) var(--sds-size-space-300);
    /* Adjust padding for toolbar-integrated button */
  }
  
  /* Override minimized state on small screens too */
  .circuit-sidebar.sidebar--minimized {
    width: min(260px, 90vw) !important;
  }
}

/* ============================================
   Mobile Sheet Navigation (replacing old sidebar)
   ============================================ */

/* Mobile menu button */
.mobile-menu-button {
  position: fixed;
  top: 0;
  left: 0;
  z-index: 100; /* Normal button level, below overlays */
  background: var(--circuit-mid-teal);
  border: none;
  border-right: 1px solid var(--circuit-light-teal);
  border-bottom: 1px solid var(--circuit-light-teal);
  border-radius: 0; /* No rounded corners */
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  transition: all 0.2s ease;
  cursor: pointer;
}

.mobile-menu-button:hover {
  background: var(--circuit-dark-teal);
}

.mobile-menu-button:active {
  transform: none; /* No scale for toolbar consistency */
}

/* Icon styling for mobile menu button */
.mobile-menu-button svg {
  color: var(--text-primary);
  width: 24px;
  height: 24px;
}

/* Mobile nav close button - positioned to look like part of toolbar */
.mobile-nav-close-button {
  position: fixed;
  top: 0;
  left: 240px; /* Position at edge of nav */
  z-index: 1101; /* Above the nav */
  background: var(--circuit-mid-teal);
  border: none;
  border-right: 1px solid var(--circuit-light-teal);
  border-bottom: 1px solid var(--circuit-light-teal);
  border-radius: 0; /* No rounded corners */
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 48px;
  height: 48px;
  transition: background-color 0.2s ease; /* Only transition bg color on hover */
  cursor: pointer;
  box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1); /* Subtle shadow to float above nav */
  animation: slide-in-from-left 200ms ease-out; /* Animate in with nav */
}

.mobile-nav-close-button:hover {
  background: var(--circuit-dark-teal);
}

.mobile-nav-close-button:active {
  transform: none; /* No scale for toolbar consistency */
}

/* Icon styling for close button */
.mobile-nav-close-button svg {
  color: var(--text-primary);
  width: 24px;
  height: 24px;
}

/* Hide desktop-specific elements on mobile */
@media (max-width: 767px) {
  .sidebar-floating-toggle {
    display: none !important;
  }
  
  /* Hide the old mobile nav toggle */
  .nav-toggle-btn {
    display: none !important;
  }
  
  /* Hide the old sidebar on mobile */
  .circuit-sidebar {
    display: none !important;
  }
}

/* Hide mobile menu button and close button on desktop */
@media (min-width: 768px) {
  .mobile-menu-button,
  .mobile-nav-close-button {
    display: none;
  }
}

/* Mobile Navigation Sheet styles */
.sheet-content .circuit-sidebar {
  position: static !important;
  transform: none !important;
  display: flex !important;
  height: 100%;
  width: 100% !important;
  box-shadow: none;
  background: var(--surface-background);
  border-right: 1px solid var(--border-default); /* Keep desktop border */
  z-index: auto;
}

/* Make mobile nav look exactly like desktop un-minimized */
.sheet-content .circuit-sidebar.sidebar--minimized {
  width: 100% !important;
}

/* Mobile sheet navigation uses EXACT same styles as desktop - no overrides */

/* Old mobile sheet logout button styles removed */

/* Ensure proper scrolling in sheet */
.sheet-content .sidebar-nav-list {
  overflow-y: auto;
  overflow-x: hidden;
  flex: 1;
}

/* Mobile sheet inherits ALL desktop styles - no special treatment */

/* Fix main content padding on mobile to prevent push down */
@media (max-width: 767px) {
  .app-content {
    padding: var(--sds-size-space-400) !important; /* Normal padding all around */
  }
  
  .main-content-area {
    padding-top: 0; /* Remove any top padding that might push content */
  }
  
  /* Ensure app layout takes full viewport on mobile */
  .app-layout {
    min-height: 100vh;
    min-height: 100dvh;
  }
  
  /* Ensure main content stays below navigation overlays */
  .main-content-area {
    position: relative;
    z-index: 1; /* Base level, below all overlays */
  }
} 